<div class="backdrop" [style.--primary]="get_playlist_primary_color()"></div>
<button class="close" (click)="close()" [style.--mask]="'url(\'chevron-left.svg\')'" [style.--primary]="get_playlist_primary_color()"></button>
<div class="header">
    <div class="cover" [ngClass]="{'single': playlist_identifier?.images.length === 1}" [style.--primary]="get_playlist_primary_color()">
        <img *ngFor="let image of playlist_identifier?.images" [src]="image" alt="" />
    </div>
    <h1 class="label">{{playlist_identifier?.name || playlist?.name || '#Playlist Name'}}</h1>
    <div class="playlist-info">
        <div class="count">{{ playlist_identifier?.track_count || 0 }} tracks</div>
        <div class="playlist-duration">{{ ms_to_time(playlist_identifier?.duration || 0) }}</div>
    </div>
    <div class="actions">
        <button class="action" (click)="change_color()" [style.--color]="get_playlist_primary_color()" [style.--mask]="'url(\'palette.svg\')'"></button>
        <button class="action" [style.--color]="get_playlist_primary_color()" [style.--mask]="'url(\'share.svg\')'"></button>
        <button class="action" [style.--color]="get_playlist_primary_color()" [style.--mask]="'url(\'edit.svg\')'"></button>
        <div class="action-wrapper" (click)="request_download_playlist()">
            <button class="action" [style.--color]="get_playlist_primary_color()" 
                [style.--mask]="'url(\'' + get_playlist_download_icon() + '\')'"
                [ngClass]="{'loading': how_many_songs_in_playlist_download_queue() > 0}"
            ></button>
            <div *ngIf="how_many_songs_in_playlist_download_queue() > 0" class="download-count" [style.--color]="get_playlist_primary_color()">{{ how_many_songs_in_playlist_download_queue() }}</div>
        </div>
    </div>
    <button class="shuffle-play" (click)="shuffle_play()" [style.--primary]="get_playlist_primary_color()">
        <div class="icon" [style.--mask]="'url(\'arrows-shuffle.svg\')'"></div>
        Shuffle Play
    </button>
</div>
<div class="result-videos" #resultVideos (scroll)="on_scroll($event)" [style.padding-top]="padding_top">
    <button 
        class="result video disable-select" 
        [ngClass]="{selected: get_bare_song_key(current_song_identifier) === get_bare_song_key(video?.id)}" 
        *ngFor="let video of visible_videos" 
            (touchstart)="video_on_swipe_start($event, video)"
            (touchmove)="video_on_swipe_move($event)"
            (touchend)="video_on_swipe_end($event)"
            (mousedown)="video_on_swipe_start($event, video)"
            (mousemove)="video_on_swipe_move($event)"
            (mouseup)="video_on_swipe_end($event)"
            (mouseleave)="video_on_swipe_end($event)"
            [attr.data-video-key]="video_key(video)"
            [style.transform]="swiping_video === video_key(video) ? 'translateX(' + swipe_x + 'px)' : ''"
            [style.border-bottom]="is_downloading(video?.id?.video_id || '') ? 'solid 1px transparent' : null"
    >
    <!-- (click)="play(video)" -->
        <div class="thumbnail" [style.background-color]="video?.colors?.primary || '#1a1c1b'">
            <img [src]="get_artwork_src(video)" alt="" />
            <div class="duration">{{ ms_to_time( video?.video_duration || 0) }}</div>
        </div>
        <div class="info">
            <div class="title">{{ video?.song_name }}</div>
            <div class="artist">{{ video?.original_artists?.[0]?.name }}</div>
        </div>
        <div class="extra-info">
            <div class="source" [style.--color]="get_source_color(video?.id?.source)" [style.--mask]="'url(\'brand-' + video?.id?.source + '.svg\')'"></div>
            <div class="liked" *ngIf="video?.liked" [style.--mask]="'url(' + 'heart-fill.svg' + ')'"></div>
            <div class="downloaded" *ngIf="video?.downloaded && video?.download_audio_blob" [style.--mask]="'url(' + 'cloud-download.svg' + ')'"></div>
        </div>
        <div class="download" *ngIf="is_downloading(video?.id?.video_id || '')">
            <div class="progress" [style.--color]="get_playlist_primary_color()"  [style.width.%]="video_progress(video?.id?.video_id || '') || is_in_download_queue(video?.id?.video_id || '')" [ngClass]="{'loading': is_in_download_queue(video?.id?.video_id || '')}"></div>
        </div>
        <div class="quick-actions" [style.width.px]="swiping_video === video_key(video) ? swipe_width : 0">
            <button [ngClass]="{hidden: swipe_x < -delete_swipe_open_size}" (click)="open_video_options(video); $event.preventDefault(); $event.stopPropagation();" [style.background-color]="'var(--color-neutral)'" class="action" [style.--mask]="'url(' + 'dots.svg' + ')'"></button>
            <button [ngClass]="{hidden: swipe_x < -delete_swipe_open_size}" (click)="toggle_like(video); $event.preventDefault(); $event.stopPropagation();" [style.background-color]="'var(--color-primary)'" class="action" [style.--mask]="'url(' + 'heart-fill.svg' + ')'"></button>
            <button [ngClass]="{hidden: swipe_x < -delete_swipe_open_size}" (click)="download_video(video); $event.preventDefault(); $event.stopPropagation();" [style.background-color]="get_playlist_primary_color()" class="action" [style.--mask]="'url(' + 'download.svg' + ')'" [style.filter]="'brightness: 0.9;'"></button>
            <button [ngClass]="{hidden: swipe_x > -delete_swipe_open_size}" [style.background-color]="'var(--color-deny)'" class="action" [style.--mask]="'url(' + 'trash.svg' + ')'"></button>
        </div>
        <!-- <button class="hot-action" [style.mask-image]="'url(\'plus.svg\')'"></button> -->
    </button>
    <div *ngIf="visible_videos.length === 0" class="no-results">
        <h2>It looks... Empty</h2>
        <p>There are no songs in this playlist yet.</p>
        <button (click)="redirect_to_search()" class="search" [style.background-color]="get_playlist_primary_color()">Look For Some! <div class="icon" [style.--mask]="'url(' + 'search.svg' + ')'"></div></button>
    </div>
</div>